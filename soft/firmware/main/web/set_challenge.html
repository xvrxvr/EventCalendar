$<!DOCTYPE html>

<html><title>Редактирование загадок</title>

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="styles.css">
<script src="jslib.js"></script>
</head>

<body>

<form action="../action/update_challenge.html" method="post" enctype="multipart/form-data">

<table><tr><td>

<table><tr><td>

Загадки:<br>
<select id="index" name="index" size="20" style="min-width:20em" onchange="upd_challenge()">
$[HTMLChallengeOptions]
</select>


</td><td>
<p>Возраст: от <input type="number" id="min-age" name="min_age" min="1" max="255" value="18" style="width:3em">, до <input type="number" id="max-age" name="max_age" min="1" max="255" value="99" style="width:3em"></p>
<p>Текст загадки:<br><textarea id="text" name="text" rows="10" cols="40">?</textarea></p>
<p>Ответ (и неправильные ответы):<br><textarea id="answer" name="answer" rows="10" cols="40">?</textarea></p>

</td></tr></table>
<p><button type="submit">Обновить загадку</button></p>
<p><button type="button" onclick="new_challenge()">Добавить новую загадку</button></p>
<p><button type="button" onclick="del_challenge()" class="red-button">Удалить загадку</button></p>
<p><button type="button" onclick="G(setup')">Назад в setup</button></p>
</td></tr></table>

</form>

<script>

function new_challenge()
{
    const name = prompt("Имя новой загадки");
    if (!name) return;
    let opts = I("index").options;
    for(let x = 0; x < opts.length; ++x)
    {
        if (opts[x].text == name) {alert(`Загадка '${name}' уже есть`); return;}
    }
    send_add_challenge(name, (new_idx) => {
        let opt = document.createElement("option");
        opt.value = new_idx.toString();
        opt.text = name;
        opts.add(opt);
        opts.selectedIndex = opts.length - 1;
        I("text").value = "?";
        I("answer").value = "?";
    });
}

function del_challenge()
{
    let opts = I("index").options;
    if (opts.selectedIndex == -1) return;
    if (!confirm("Удалить загадку? Вы уверены?")) return;
    send_del_challenge(opts.options[opts.selectedIndex].value);
    opts.remove(opts.selectedIndex);
    upd_challenge();
}

function upd_challenge()
{
    let opts = I("index").options;
    if (opts.selectedIndex == -1)
    {
        I("text").value = "";
        I("answer").value = "";        
        I("min-age").value = 1;
        I("max-age").value = 99;
        return;
    }
    send_get_challenge(opts[opts.selectedIndex].value, (json) => {
        I("text").value = json.text;
        I("answer").value = json.answer;        
        I("min-age").value = json.min_age;
        I("max-age").value = json.max_age;
    });
}


</script>

</html>

